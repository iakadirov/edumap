# Настройка Яндекс.Карт для EduMap

## Получение API ключа

1. Перейдите на [Яндекс.Кабинет разработчика](https://developer.tech.yandex.ru/)
2. Войдите в свой аккаунт Яндекс
3. **ВАЖНО:** Вам нужно подключить **"JavaScript API и HTTP Геокодер"** (это один продукт, который включает оба API)
4. Нажмите "Подключить API" и выберите **"JavaScript API и HTTP Геокодер"**
5. Создайте новое приложение или выберите существующее
6. Скопируйте API ключ

**Примечание:** Если вы видите только "MapKit" или другие опции, но не видите "JavaScript API", возможно нужно:

- Прокрутить список вниз
- Или найти в разделе "Ещё"
- Или это может быть отдельный раздел в меню кабинета

## Настройка переменных окружения

Добавьте следующие переменные в ваш `.env.local` файл:

```env
# Яндекс.Карты API ключ (для серверной части - геокодирование)
YANDEX_MAPS_API_KEY=ваш_api_ключ_здесь

# Яндекс.Карты API ключ (для клиентской части - отображение карты)
NEXT_PUBLIC_YANDEX_MAPS_API_KEY=ваш_api_ключ_здесь
```

**Важно:**

- `YANDEX_MAPS_API_KEY` используется на сервере для геокодирования (получение адреса по координатам)
- `NEXT_PUBLIC_YANDEX_MAPS_API_KEY` используется на клиенте для отображения карты
- Можно использовать один и тот же ключ для обеих переменных

## Функциональность

После настройки API ключа в формах добавления/редактирования школ будет доступна:

1. **Интерактивная карта** - отображает Яндекс.Карту с центром в Ташкенте
2. **Установка маркера** - клик по карте устанавливает маркер и сохраняет координаты
3. **Перетаскивание маркера** - маркер можно перетаскивать для точной установки местоположения
4. **Автоматическое заполнение адреса** - при установке маркера адрес автоматически заполняется через геокодирование

## Использование

1. Откройте форму добавления/редактирования школы
2. В разделе "Контакты и адрес" найдите карту
3. Кликните на карте в нужном месте - маркер установится
4. Адрес автоматически заполнится в поле "Адрес"
5. При необходимости перетащите маркер для более точного местоположения
6. Адрес можно также отредактировать вручную

## Технические детали

- Компонент карты: `src/components/admin/schools/YandexMap.tsx`
- API геокодирования: `src/app/api/geocode/route.ts`
- Используется Яндекс.Геокодер API для обратного геокодирования (координаты → адрес)
- Карта загружается динамически только на клиенте

## Устранение проблем

### Ошибка 403 Forbidden при геокодировании

Если вы видите ошибку `403 Forbidden` в консоли, это означает, что ваш API ключ не имеет доступа к HTTP Геокодеру.

**Решение:**

1. Убедитесь, что вы подключили именно **"JavaScript API и HTTP Геокодер"** (это один продукт)
2. Проверьте в личном кабинете, что API ключ активен и имеет доступ к Геокодеру
3. Если вы подключили только "JavaScript API" без Геокодера, нужно:
   - Отключить текущий API
   - Подключить "JavaScript API и HTTP Геокодер"
   - Получить новый API ключ
   - Обновить переменные окружения

### Геокодирование не работает

Если геокодирование не работает, проверьте:

1. Откройте консоль браузера (F12) и посмотрите ошибки
2. Проверьте консоль сервера (терминал, где запущен `npm run dev`)
3. Убедитесь, что сервер перезапущен после добавления переменных окружения
4. Проверьте, что API ключ правильно скопирован в `.env.local` (без пробелов, кавычек)
